---
name: Codex MetaSurface Agent
description: >
  Automates creation of new modules for the metasurface project (meta_library, CLI interfaces, and bilingual notebooks).
  Uses the `reorg-estrutura` branch, following the existing structure of holography modules (GS/ASM and Dammann FFT).
  Works non-destructively: never modifies or deletes legacy files, only adds new ones.
permissions:
  contents: write
  pull_requests: write
  issues: write
run_as: github-copilot
---

# Codex MetaSurface Agent

## Purpose
This agent extends the repository structure by adding the **meta_library** and **CLI** toolchain for metasurface phase-matching and heatmap generation.
It must create new Python modules, command-line interfaces, documentation, and bilingual notebooks compatible with the existing `src/holography` framework.

## Context
The repository already contains:
- `src/holography/gs_asm.py` and `src/dammann/dammann_fft.py` (CLI-ready scripts for GS and Dammann algorithms)
- `docs/`, `results/`, and `notebooks/holography/explanations/`

The branch `reorg-estrutura` also includes a folder `legacy/phase_matching/` with the original reference scripts and notebooks:
`DfGen.py`, `RawDFgenerator.py`, `HeatmapsGenerator*.ipynb`, `Phase_Matching*.ipynb`, etc.

These legacy files must **never** be modified or removed.  
They serve only as references for logic migration and compatibility testing.

## Guidelines
- Work strictly on branch **reorg-estrutura**.
- Never overwrite or delete existing files.
- Create new directories if missing:
  - `src/meta_library/`
  - `src/cli/`
  - `notebooks/meta_library/`
  - `tests/`
- Follow the repository coding conventions:
  - Python 3.10+
  - argparse-based CLI
  - docstrings and inline comments in **English + Portuguese**
  - logging instead of print statements
  - consistent naming: `L_x`, `L_y`, `H`, `frequencia_hz`, `Sij_real`, `Sij_imag`
- Write modular, reusable functions (no hard-coded paths).
- Commit changes in small logical chunks (one module or notebook per commit).
- Open a **Pull Request** summarizing all additions once generation is complete.

## Tasks
1. **Create new modules under `src/meta_library/`**:
   - `generate_df.py`: parse Touchstone files into a DataFrame.
   - `clean_library.py`: normalize and enrich the library with derived columns (|T|, phase_TE/TM).
   - `phase_matching.py`: implement heatmap generation and phase-matching algorithms, including optional height parameter.
2. **Create CLI wrappers in `src/cli/`**:
   - `run_library_build.py`, `run_library_clean.py`, `run_heatmaps.py`, `run_phase_matching.py`
   - Use argparse and follow the pattern of `src/holography/gs_asm.py`.
3. **Generate bilingual notebooks** under `notebooks/meta_library/`:
   - `01_Library_Heatmaps_Explanation.ipynb`
   - `02_Phase_Matching_Explanation.ipynb`
   - Both must include theoretical background (PT/EN), parameter setup, and example execution.
4. **Add short README.md files** for each new directory explaining usage and structure.
5. **Add minimal tests** in `tests/test_meta_library.py` verifying data parsing, cleaning, and heatmap generation.
6. **Ensure safe integration**:
   - No modification of `src/holography/**` or legacy files.
   - All new outputs written to `results/meta_library/...`.
   - All scripts and notebooks must run independently of external large datasets.
7. **Document your work**:
   - Each new module and notebook must include a header with creation date, author (`github-copilot`), and version.
   - Include bilingual docstrings (English first, Portuguese below).

## Deliverables
src/meta_library/generate_df.py
src/meta_library/clean_library.py
src/meta_library/phase_matching.py
src/meta_library/README.md

src/cli/run_library_build.py
src/cli/run_library_clean.py
src/cli/run_heatmaps.py
src/cli/run_phase_matching.py
src/cli/README.md

notebooks/meta_library/01_Library_Heatmaps_Explanation.ipynb
notebooks/meta_library/02_Phase_Matching_Explanation.ipynb
notebooks/meta_library/README.md

tests/test_meta_library.py
The following new files/folders must exist after the agent completes its work:

## Quality Requirements
- Fully functional, importable Python code.
- Reproducible results (same output given same inputs).
- Comprehensive comments for future contributors.
- All changes pushed to branch `reorg-estrutura` and opened as a pull request titled:
  > "feat(meta_library): add heatmaps and phase-matching modules (auto-generated by Copilot Agent)"
